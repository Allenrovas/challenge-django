<!DOCTYPE html>
<html>
<head>
    <style>
        .product-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .product {
            border: 1px solid #000;
            margin: 10px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Product List</h1>
    <button onclick="fetchProducts()">Refresh Products</button>
    <div id="product-container" class="product-container"></div>

    <h2>Place an Order</h2>
    <form id="order-form">
        <label for="product-name">Product Name:</label><br>
        <input type="text" id="product-name" name="product-name"><br>
        <label for="quantity">Quantity:</label><br>
        <input type="number" id="quantity" name="quantity"><br>
        <input type="submit" value="Submit Order">
    </form>

    <script>
        var apiURL = 'http://127.0.0.1:8000/api'
        function fetchProducts() {
            fetch(`${apiURL}/products/`)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    const container = document.getElementById('product-container');
                    container.innerHTML = ''; // Clear the container
                    data.forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'product';
                        div.textContent = `Name: ${product.name}, Price: ${product.price}, Quantity: ${product.quantity}`;
                        container.appendChild(div);
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        document.getElementById('order-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from being submitted normally
            const productName = document.getElementById('product-name').value;
            const quantity = document.getElementById('quantity').value;
            fetch(`${apiURL}/order/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({product: productName, quantity: quantity}),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                alert(`Total cost of order: ${data.total}`);
            })
            .catch(error => console.error('Error:', error));
        });

        window.onload = function() {
            fetchProducts();
        };
    </script>
</body>
</html>
